package app;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.PrintWriter;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;

public class App {
	
	public static void main(String[] args) throws MalformedURLException {
	
		String testDirectory = System.getProperty("user.dir");
		String[] split = testDirectory.split("/");
		String finaldir = "";
		for(int i = 0; i < split.length-1; i ++) {
			
			finaldir += split[i] + "/";
		}
		finaldir+="data/";
		
		//File dir1 = new File(new URL(finaldir).getFile());
		//File[] directoryListing1 = dir1.listFiles();
		
		
		URL directory = App.class.getResource("data/");
		File dir = new File(directory.getFile());
		File[] directoryListing = dir.listFiles();
		
		Book[] books = null;
		
		if (directoryListing != null) {
			
			books = new Book[directoryListing.length];
			for(int i = 0; i < directoryListing.length; i ++) {
				
				Parser htmlParser = new Parser(directoryListing[i].toURI().toURL());
				books[i] = htmlParser.Parse();
			}
			
		} else {
			
			System.err.println("Couldn't find data directory");
		    System.exit(1);
		}
		
		Packer packer = new Packer(books);
		ArrayList<Box> boxes = packer.packBooks();
		
		String boxList="";
		for(Box box : boxes) {
			
			Gson gson = new GsonBuilder().setPrettyPrinting().create();
			String json = gson.toJson(box);
			boxList+=json + "\n";
		}
		
		try(PrintWriter out = new PrintWriter("output.json")) {
		    out.println(boxList);
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
}