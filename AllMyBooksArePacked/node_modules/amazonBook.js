// what this module does	
	// input  => amazon book html pages
	// output => array of json object with book data ex: author, title, price etc
	// process => parsing book data from amazon books html
var book = require('book');
var cheerio = require('cheerio');

// extract book data from amazon pages 
function getTitle(){
	$('span[id=btAsinTitle]').filter(function(){
		 title = $(this)[0].parent.parent.children[3].children[1].children[0].data.trim();
	});
}

function getAuthor(){
	$('span[id=btAsinTitle]').filter(function(){
		author = $(this)[0].children[0].data.trim();
	});
}

function getPrice(){
	$('span[class=bb_price]').filter(function(){
		price = $(this)[0].children[0].data.trim();
	});
}

function getWeight(){
	$('b').filter(function(){
		var stuff = $(this);
		if(stuff.text() == "Shipping Weight:"){
			var str = $(this)[0].next.data.trim();
			var WeightArr = str.split(" ");
		  weight = WeightArr[0] + " " + WeightArr[1];
		}
	});
}

function getISBN_10(){
	$('b').filter(function(){
		var stuff = $(this);
		if(stuff.text() == "ISBN-10:"){
			ISBN_10 = $(this)[0].next.data.trim();
		}
	});
}


function getJSON(data,callback){
	// we'll return an array of json objects with book data
	json = [];

	// cycle through html pages and get json
	function eachData(i){
		if(i<data.length){
			$ = cheerio.load(data[i].toString());
			getTitle();
			getAuthor();
			getPrice();
			getWeight();
			getISBN_10();
			json.push(new book.book(title,author,price,weight,ISBN_10));
			return eachData(i+1); 
		}else{
			callback(json);
		}
	}

	eachData(0);
};

module.exports = {
	json: getJSON
}